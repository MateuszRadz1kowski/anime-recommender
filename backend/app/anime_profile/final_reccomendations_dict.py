from backend.app.anime_profile.create_anime_profile import create_anime_profile
from backend.app.db.get_data.get_anime_data_db import get_anime_data
from backend.app.db.get_data.get_recommended_animes_data import get_recommended_animes_data
from backend.app.user_profile.create_user_interests_profile import create_user_interests_profile


def prepare_dictionary():
    recommendations_dictionary = {}
    anime_data = get_anime_data()
    user_interests_profile = create_user_interests_profile()
    anime_recommendations = create_anime_profile(anime_data, user_interests_profile)
    prepare_recommendation_reasons(anime_recommendations)
    print(f"tag scores: {user_interests_profile[0]}")
    print(f"genre scores: {user_interests_profile[1]}")
    print(f"anime recommendations: {anime_recommendations}")
    # anime_recommendations = {'86 EIGHTY-SIX': 0.1791979926718628, 'Akame ga Kill!': 0.1633399860032548, 'DARLING in the FRANXX': 0.16275194649985153, 'ONE PIECE': 0.16045348854611202, 'Dororo': 0.1603610991187803, 'Black Clover': 0.15176538720235658, 'Neon Genesis Evangelion': 0.14987393576100844, 'Gurren Lagann': 0.1445786378292489, 'Fullmetal Alchemist': 0.12883386293678759, 'Fate/Zero': 0.12482364723884837, 'Fire Force': 0.12175490896996827, 'Danganronpa: The Animation': 0.11969139667117791, 'Tower of God': 0.11848152907611229, 'Tokyo Ghoul': 0.11700412034150126, 'Cowboy Bebop': 0.11146455975118837, 'Dragon Ball Z': 0.11105605518462003, 'Oshi No Ko': 0.11069448313088105, 'Summer Time Rendering': 0.11049514250574502, 'Fruits Basket (2019)': 0.10952997482521894, 'That Time I Got Reincarnated as a Slime': 0.10940722873530084, 'ERASED': 0.10927397596652808, 'Made in Abyss': 0.10650705943795503, 'Kaiju No. 8': 0.10437925747925528, 'Bungo Stray Dogs': 0.10390186259794401, 'Gintama': 0.10344843156697732, 'Delicious in Dungeon': 0.09732994176116408, 'The Future Diary': 0.09648184624408271, 'SPY x FAMILY': 0.09542778068235117, "JoJo's Bizarre Adventure: Golden Wind": 0.09394406171421811, 'The Eminence in Shadow': 0.09344570283001401, 'The Promised Neverland': 0.09324314150720941, 'The Rising of the Shield Hero': 0.08977153433679311, 'The Seven Deadly Sins': 0.08857556423174018, 'Elfen Lied': 0.08832699899508167, 'Seraph of the End: Vampire Reign': 0.08821130933711573, 'Puella Magi Madoka Magica': 0.08753824694604923, 'Overlord': 0.0873516000941686, 'Mob Psycho 100': 0.08635381269451875, 'To Your Eternity': 0.0861937517373289, 'Tengoku Daimakyo': 0.08447782065997665, 'PSYCHO-PASS': 0.08392498561647352, 'Fairy Tail': 0.08363957044635481, 'Soul Eater': 0.08324503778727427, 'BANANA FISH': 0.08154398526152558, 'Fire Force Season 2': 0.0809241788270859, 'Ranking of Kings': 0.08088974755418801, 'My Hero Academia Season 6': 0.0807235665238374, 'Deadman Wonderland': 0.08053651470921294, 'Yona of the Dawn': 0.08006070345766357, 'The Case Study of Vanitas': 0.08002658808879465, 'Fate/Zero Season 2': 0.0797502709894169, 'Samurai Champloo': 0.07882337686336958, 'Bungo Stray Dogs 2': 0.07840146318076524, 'Saga of Tanya the Evil': 0.0782869667017947, 'High School of the Dead': 0.07827865138643285, 'Classroom of the Elite': 0.07826843346462116, 'That Time I Got Reincarnated as a Slime Season 2': 0.07815468250281177, 'Dragon Ball': 0.07726920512078932, 'The Promised Neverland Season 2': 0.07714891540190846, 'Zom 100: Bucket List of the Dead': 0.07489232837539639, 'Black Butler': 0.07447081407380704, 'Sword Art Online: Alicization - War of Underworld': 0.07446544710612432, 'Overlord III': 0.07423347610400428, "Arifureta: From Commonplace to World's Strongest": 0.07419809703629827, 'Blood Blockade Battlefront': 0.07291167158704058, 'My Hero Academia Season 4': 0.07259892663176395, 'Tokyo Revengers': 0.07233417255498861, 'Sword Art Online: Alicization': 0.07225245628496738, 'Angel Beats!': 0.07218448358812102, 'That Time I Got Reincarnated as a Slime Season 2 Part 2': 0.07181298220255732, 'Assassination Classroom': 0.0717733528007926, 'Bakemonogatari': 0.06924062069992472, "JoJo's Bizarre Adventure: Diamond is Unbreakable": 0.06881664459920878, 'Sword Art Online': 0.06869926340593675, 'The Misfit of Demon King Academy: History’s Strongest Demon King Reincarnates and Goes to School with His Descendants': 0.06858763777642143, "The Ancient Magus' Bride": 0.06789176777592612, 'Guilty Crown': 0.06776544280694465, 'The Seven Deadly Sins: Imperial Wrath of the Gods': 0.06766809595970681, 'Assassination Classroom Second Season': 0.06755079642652043, 'Sword Art Online: Alicization - War of Underworld Part 2': 0.06719758151756076, 'Terror in Resonance': 0.06636044866782673, 'Black Lagoon': 0.06580162207820477, 'SPY x FAMILY Cour 2': 0.06513554964174958, "KONOSUBA -God's blessing on this wonderful world!": 0.06491369883724574, 'WONDER EGG PRIORITY': 0.06483068699344792, 'SPY x FAMILY Season 2': 0.06481084252790723, 'BEASTARS': 0.06449698977485206, 'Date A Live': 0.06409587731443152, 'Classroom of the Elite Season 2': 0.06347925715796743, 'My Hero Academia Season 5': 0.06313382468839485, 'Beyond the Boundary': 0.0627508354507003, 'Bleach': 0.06217592324863224, 'Angels of Death': 0.06187718638201021, 'Another': 0.06051999103139813, 'Serial Experiments Lain': 0.06050011813317622, 'Your lie in April': 0.06004245479242439, 'Mob Psycho 100 II': 0.05997686501033265, 'My Hero Academia Season 3': 0.059084104602852544, 'Mob Psycho 100 III': 0.058570835420235674, 'Magi: The Labyrinth of Magic': 0.057877152651799275, 'Fate/stay night: Unlimited Blade Works': 0.05731505165397348, 'Tokyo Ghoul:re': 0.05727214504831693, 'My Hero Academia': 0.05704044039526463, 'Overlord II': 0.056642333142181055, 'Baccano!': 0.05640125545972458, 'The God of High School': 0.05517147480959771, 'Clannad: After Story': 0.05515393638884405, 'The Rising of the Shield Hero Season 2': 0.05463875268229984, 'GOBLIN SLAYER': 0.05450018581363421, 'Fate/stay night: Unlimited Blade Works 2nd Season': 0.053993246437616826, 'Noragami': 0.05383420570350711, 'Blue Exorcist': 0.05354243221473366, 'Kakegurui': 0.05280724514752501, 'Noragami Aragoto': 0.0522599764249205, 'Tokyo Ghoul √A': 0.05203441123007829, 'Dragon Ball Super': 0.051953940315406844, 'Toilet-bound Hanako-kun': 0.05188108713431742, 'The Seven Deadly Sins: Revival of the Commandments': 0.05104891466849029, 'Lycoris Recoil': 0.05003667978893802, 'Kaguya-sama: Love is War?': 0.04939740870181658, "The Misfit of Demon King Academy Ⅱ: History's Strongest Demon King Reincarnates and Goes to School with His Descendants": 0.04931104867821219, 'Clannad': 0.04738648466142554, 'MASHLE: MAGIC AND MUSCLES': 0.046592676968187655, "KONOSUBA -God's blessing on this wonderful world! 2": 0.046432505423314445, 'Chivalry of a Failed Knight': 0.045755301926018975, 'given': 0.04554879718390298, 'The Melancholy of Haruhi Suzumiya': 0.04549908035037095, 'Is It Wrong to Try to Pick Up Girls in a Dungeon?': 0.04523780613125055, 'My Teen Romantic Comedy SNAFU TOO!': 0.04494390607378972, 'The Irregular at Magic High School': 0.0438034636145345, 'Megalobox': 0.043087130404088715, 'Kiznaiver': 0.04267757788622223, 'High School DxD': 0.042533932995738766, 'Golden Time': 0.042114541580767655, 'Tokyo Ghoul:re 2': 0.042033091728866434, 'Plastic Memories': 0.04156397389932203, 'Log Horizon': 0.041466021135048166, 'Sword Art Online II': 0.04145716940385656, 'My Hero Academia Season 2': 0.04091411878766798, 'Kakegurui xx': 0.04083536373034801, 'The Quintessential Quintuplets': 0.04043555533453734, 'Call of the Night': 0.04013541698542586, "Kuroko's Basketball": 0.0397985134365303, 'The Quintessential Quintuplets 2': 0.03896684487867191, 'My Teen Romantic Comedy SNAFU': 0.03883099256336133, 'The Devil is a Part-Timer!': 0.037720707368295685, 'Orange': 0.03708246029443187, 'March comes in like a lion': 0.03704273976396535, 'How NOT to Summon a Demon Lord': 0.03692473223345307, 'Cells at Work!': 0.03666886842381104, 'Anohana: The Flower We Saw That Day': 0.03652387952154628, 'Boruto: Naruto Next Generations': 0.03621300217169982, 'Durarara!!': 0.035834751663926204, 'SHIMONETA: A Boring World Where the Concept of Dirty Jokes Doesn’t Exist': 0.035823259717304726, 'NANA': 0.03549016226226032, 'HAIKYU!!': 0.0351592444236441, 'Kaguya-sama: Love is War -Ultra Romantic-': 0.034874353369811865, 'Kaguya-sama: Love is War': 0.03480060997044154, 'Ouran High School Host Club': 0.034733265140402106, 'Rent-a-Girlfriend': 0.03439400267521134, 'Is It Wrong to Try to Pick Up Girls in a Dungeon? II': 0.033595917503428115, 'Komi Can’t Communicate': 0.032411242012514975, 'HAIKYU!! TO THE TOP Part 2': 0.0322568719057079, 'HAIKYU!! 2nd Season': 0.0321468422569579, 'The Pet Girl of Sakurasou': 0.032142220946807715, 'My Teen Romantic Comedy SNAFU Climax!': 0.03181932668727203, 'I Got a Cheat Skill in Another World and Became Unrivaled in The Real World, Too': 0.030137148297446185, 'HAIKYU!! 3rd Season': 0.03005497579260731, 'Yuri!!! on ICE': 0.029974342872307658, 'Horimiya': 0.02974725921938818, 'Toradora!': 0.0279156273482059, 'Love, Chunibyo & Other Delusions': 0.02777634236419396, 'Wotakoi: Love is Hard for Otaku': 0.027618613128520323, 'Domestic Girlfriend': 0.027333365822779197, 'Prison School': 0.02679700610746876, 'HAIKYU!! TO THE TOP': 0.02671988617391123, 'Pokémon the Series: XYZ': 0.02623174270247933, "Miss Kobayashi's Dragon Maid": 0.025625114117334397, "Masamune-kun's Revenge": 0.02523897606969059, 'Reborn as a Vending Machine, I Now Wander the Dungeon': 0.025053694449513234, 'Nisekoi': 0.024852446030033927, "Shikimori's Not Just a Cutie": 0.024365723366202702, 'Kimi ni Todoke: From Me to You': 0.024130621669179196, 'TONIKAWA: Over The Moon For You': 0.02386431316387738, 'Blue Spring Ride': 0.023435655996258773, 'BOCCHI THE ROCK!': 0.023424531242649555, 'Grand Blue Dreaming': 0.023254136772937715, 'SK8 the Infinity': 0.022897708840976427, "Monthly Girls' Nozaki-kun": 0.022450450667244975, 'Nichijou - My Ordinary Life': 0.02212638736613705, 'Hyouka': 0.021967517912772506, 'My Dress-Up Darling': 0.021747866668450775, "DON'T TOY WITH ME, MISS NAGATORO": 0.020613876107297053, 'Maid-Sama!': 0.018884933592724005, 'Food Wars!': 0.018350941757124678, 'K-ON!': 0.018055685135420614, 'Food Wars! The Third Plate': 0.016886703793066355, 'My Little Monster': 0.015550440811374374, 'Food Wars! The Second Plate': 0.01451149523873881, 'Sakura Trick': 0.013097027065348116}
    # {"AOT":{"score":0.22,"why_recommended":{"gore":0.34,"survival":0.21}}}
    recommended_anime_data = get_recommended_animes_data(tuple(anime_recommendations))
    for recommendation in anime_recommendations.keys():
        recommendations_dictionary[recommendation] = {}
    for recommendation_data in recommended_anime_data:
        recommendations_dictionary[recommendation_data[2]]["id"] = recommendation_data[0]
        recommendations_dictionary[recommendation_data[2]]["id_mal"] = recommendation_data[1]
        recommendations_dictionary[recommendation_data[2]]["title"] = recommendation_data[2]
        recommendations_dictionary[recommendation_data[2]]["season_year"] = recommendation_data[3]
        recommendations_dictionary[recommendation_data[2]]["format"] = recommendation_data[4]
        recommendations_dictionary[recommendation_data[2]]["isAdult"] = recommendation_data[5]
        recommendations_dictionary[recommendation_data[2]]["mean_score"] = recommendation_data[6]
        recommendations_dictionary[recommendation_data[2]]["description"] = recommendation_data[7]
        recommendations_dictionary[recommendation_data[2]]["episode_number"] = recommendation_data[8]
        recommendations_dictionary[recommendation_data[2]]["cover_image"] = recommendation_data[9]
        recommendations_dictionary[recommendation_data[2]]["trailer_id"] = recommendation_data[10]
        recommendations_dictionary[recommendation_data[2]]["trailer_site"] = recommendation_data[11]
        recommendations_dictionary[recommendation_data[2]]["season"] = recommendation_data[12]
        recommendations_dictionary[recommendation_data[2]]["score"] = anime_recommendations[recommendation_data[2]]["score"]
        recommendations_dictionary[recommendation_data[2]]["why_recommended"] = anime_recommendations[recommendation_data[2]]["why_recommended"]



def prepare_recommendation_reasons(anime_recommendations):
    for data in anime_recommendations.values():
        reasons = data["why_recommended"]

        data["why_recommended"] = dict(
            sorted(
                reasons.items(),
                key=lambda x: x[1],
                reverse=True
            )[:4]
        )



prepare_dictionary()